<?php
$game = $this->getData('game');
$currentPlayer = $this->getData('player');
$isGameEnd = (bool) $this->getData('is_game_ended');
?>
<div class="result-message">
    <?php if ($isGameEnd): ?>
        <?php if ($currentPlayer->player_rank == 1): ?>
            <i class="fas fa-trophy" style="color: gold; font-size: 48px;"></i><br/><br/>
        <?php elseif ($currentPlayer->player_rank == 2): ?>
            <i class="fas fa-trophy" style="color: silver; font-size: 40px;"></i><br/><br/>
        <?php elseif ($currentPlayer->player_rank == 3): ?>
            <i class="fas fa-trophy" style="color: brown; font-size: 35px;"></i><br/><br/>
        <?php endif ?>
    <?php endif ?>
    <?= $this->getData('message') ?>
</div>
<?php if ($currentPlayer->view_type !== \App\Models\Player::VIEW_TYPE_HOST): ?>
    <?php if (!$isGameEnd): ?>
        <a href="#" onclick="action('setPlayerReady')" id="button-ready" class="<?= !$currentPlayer->has_answer ? 'ready' : ''?>">
            <?php if ($currentPlayer->has_answer): ?>Gotowy<?php else: ?>Oczekuje<?php endif ?>
        </a>
    <?php else: ?>
        <a href="#" onclick="action('setPlayerReady')" id="button-ready" class="<?= !$currentPlayer->has_answer ? 'ready' : ''?>">
            <?php if ($currentPlayer->has_answer): ?>Zagraj ponownie<?php else: ?>Oczekuje<?php endif ?>
        </a>
    <?php endif ?>
<?php endif ?>
<?php if ($currentPlayer->view_type !== \App\Models\Player::VIEW_TYPE_CONTROLLER): ?>
    <div id="players-list">
        <?php foreach($this->getData('players') as $player): ?>
            <?php
                if (!$game->round) {
                    $class = '';
                } else if (app(\App\Models\Player::class)->hasCorrectAnswer($player, $game)) {
                    $class = 'correct';
                } else {
                    $class = 'incorrect';
                }
            ?>
            <div class="player-row <?= $class ?? '' ?>">
                <div class="name">
                    <?php if ($isGameEnd): ?>
                        <?php if ($player->player_rank == 1): ?>
                            <i class="fas fa-trophy" style="color: gold; font-size: 48px;"></i>
                        <?php elseif ($player->player_rank == 2): ?>
                            <i class="fas fa-trophy" style="color: silver; font-size: 40px;"></i>
                        <?php elseif ($player->player_rank == 3): ?>
                            <i class="fas fa-trophy" style="color: brown; font-size: 35px;"></i>
                        <?php endif ?>
                    <?php endif ?>
                    <?= $player->name ?>
                    <?php if (!$isGameEnd): ?>
                        <?php if ($player->has_answer): ?>
                            <span class="pending">(Oczekuje)</span>
                        <?php else: ?>
                            <span class="ready">(Gotowy)</span>
                        <?php endif ?>
                    <?php endif ?>
                </div>
                <div class="accuracy">
                    <?php if ($player->answered_questions_qty): ?>
                        <?= round($player->correct_answered_questions_qty / $player->answered_questions_qty * 100) ?>%
                    <?php endif ?>
                </div>
                <div class="points"><?= $player->total_points ?> pkt.</div>
            </div>
        <?php endforeach ?>
    </div>
<?php endif ?>