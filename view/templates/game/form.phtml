<div id="game-creator">
    <form id="form" method="post" action="create">
        <div id="top-buttons-container">
            <input type="submit" value="Stwórz" id="button-ready">
            <div id="game-config-container">
                <input type="checkbox" 
                        id="game-config-checkbox" 
                        name="" 
                        value="0"
                        onclick="toogleGameConfig(this)">
                <label for="game-config-checkbox"><i class="fa-solid fa-gear"></i></label>
            </div>
        </div>
        <div id="game-config"  style="display:none">
            <label for="config-rounds-qty">Ilość Rund</label>
            <input type="text"
                   id="config-rounds-qty"
                   name="config[rounds-qty]"
                   value="10">
            <label for="config-rounds-qty">Pokaż poprawną odpowiedź</label>
            <select
                   id="show-correct-answer"
                   name="config[show-correct-answer]">
                <option value="0" selected>Nie</option>
                <option value="1">Tak</option>
                <option value="2">Tylko do pytań AI</option>
            </select>
        </div>
        <?php
            $providers = app(\App\Models\Game::class)->getQuestionProviders();
        ?>
        <div id="quiz-checkboxes">
            <?php foreach ($providers as $providerId => $provider): ?>
                <input type="checkbox" 
                    id="provider-<?= $providerId ?>" 
                    name="questions[<?= $providerId ?>][selected]" 
                    value="1"
                    onclick="providerSelected(this)">
                <label for="provider-<?= $providerId ?>"><?= $provider->label ?></label>
                <div id="provider-<?= $providerId ?>-options" class="question-provider-options" style="display:none">
                    <div class="question-set-priority">
                        <div class="button" onclick="updatePriority('<?= $providerId ?>', -10)">-10</div>
                        <div class="button" onclick="updatePriority('<?= $providerId ?>', -1)">-</div>
                        <div class="value">
                            Priorytet:
                            <input type="text" id="priority-<?= $providerId ?>" name="questions[<?= $providerId ?>][priority]" value="<?= $provider->defaultPriority ?>" readonly>
                        </div>
                        <div class="button" onclick="updatePriority('<?= $providerId ?>', 1)">+</div>
                        <div class="button" onclick="updatePriority('<?= $providerId ?>', 10)">+10</div>
                    </div>
                    <?php if ($optionsBlock = $provider->getOptionsBlock(['provider_id' => $providerId])): ?>
                        <?= $optionsBlock->getHtml() ?>
                    <?php endif ?>
                </div>
            <?php endforeach ?>
        </div>
    </form>
</div>
<script>
function toogleGameConfig(checkbox) {
    let gameConfigContainer = $("#game-config");
    if (checkbox.checked) {
        gameConfigContainer.show();
    } else {
        gameConfigContainer.hide();
    }
}
function providerSelected(elem) {
    let optionsContenerId = elem.id + "-options";
    if (elem.checked) {
        $("#" + optionsContenerId).show();
    } else {
        $("#" + optionsContenerId).hide();
    }
}
function updatePriority(providerId, value) {
    let elem = $("#priority-" + providerId);
    let newPriority = parseInt(elem.val()) + parseInt(value);
    if (newPriority < 1) {
        newPriority = 1;
    }
    if (newPriority > 100) {
        newPriority = 100;
    }
    elem.val(newPriority);
}
</script>